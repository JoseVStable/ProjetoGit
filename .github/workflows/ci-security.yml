name: Security Minimal (SAST & DAST)

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  # ===============================================
  # 1. SAST - CodeQL (An√°lise Est√°tica)
  # ===============================================
  sast_codeql:
    name: SAST - CodeQL
    runs-on: ubuntu-latest
    steps:
      - name: ‚¨áÔ∏è Checkout do C√≥digo
        uses: actions/checkout@v4
        
      - name: üîç CodeQL - Inicializar
        uses: github/codeql-action/init@v3
        with:
          languages: javascript 
          
      - name: üõ°Ô∏è CodeQL - Analisar
        uses: github/codeql-action/analyze@v3

  # ===============================================
  # 2. DAST - OWASP ZAP (An√°lise Din√¢mica)
  # ===============================================
  dast_zap:
    name: DAST - OWASP ZAP
    needs: sast_codeql
    runs-on: ubuntu-latest
    
    steps:
      - name: ‚¨áÔ∏è Checkout do C√≥digo
        uses: actions/checkout@v4
        
      # Passo √önico para Servir: Instala√ß√£o e In√≠cio do 'serve'
      - name: üöÄ Instalar e Iniciar Servidor Local
        # Instala temporariamente o 'serve' e o executa em background
        run: |
          npm install -g serve # Instala o 'serve' globalmente no runner
          serve -s . -l 3000 & 
          sleep 5 # D√° tempo para o servidor iniciar

      - name: üí• DAST - ZAP Baseline Scan
        uses: zaproxy/action-baseline@v0.12.0
        with:
          target: 'http://localhost:3000'
          fail_action: true