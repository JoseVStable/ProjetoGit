name: Static Web Security - 2 Nodes

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

jobs:
  # ===============================================
  # NÃ“ 1: SAST - Static Application Security Testing
  # ===============================================
  sast_job:
    runs-on: ubuntu-latest
    steps:
      - name: â¬‡ï¸ Checkout do CÃ³digo
        uses: actions/checkout@v4
        
      - name: âš™ï¸ Configurar Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          
      - name: ğŸ“¦ Instalar DependÃªncias (Se houver package.json)
        # NecessÃ¡rio se houver um package.json para que linters funcionem
        run: npm install

      - name: ğŸ›¡ï¸ SAST Placeholder (AnÃ¡lise de CÃ³digo EstÃ¡tico)
        # Para projetos estÃ¡ticos, o SAST real seria um linter de seguranÃ§a
        # (ex: para verificar o uso correto de JS ou estrutura HTML)
        run: echo "SAST node completed. Substituir este comando pelo seu linter de seguranÃ§a preferido."
        # Exemplo real: Rodar um linter configurado (ex: npx eslint . --ext .js --max-warnings 0)

      # O CodeQL (GitHub Advanced Security) tambÃ©m seria um bom SAST aqui,
      # mas o CodeQL tem seu prÃ³prio processo de setup e upload.

  # ===============================================
  # NÃ“ 2: DAST - Dynamic Application Security Testing
  # ===============================================
  dast_job:
    needs: sast_job # Garante que o DAST sÃ³ comece apÃ³s o SAST terminar
    runs-on: ubuntu-latest
    
    steps:
      - name: â¬‡ï¸ Checkout do CÃ³digo
        uses: actions/checkout@v4
        
      - name: âš™ï¸ Configurar Node.js (Para o 'serve')
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          
      - name: ğŸ“¦ Instalar DependÃªncias (Se existir package.json)
        run: npm install
        
      - name: ğŸš€ Iniciar Servidor Simples
        # Inicia o servidor estÃ¡tico na porta 3000 em background
        run: npx serve -s . -l 3000 & 
        run: sleep 5 # Espera 5 segundos para o servidor iniciar completamente
        
      - name: ğŸ’¥ DAST - OWASP ZAP Baseline Scan
        uses: zaproxy/action-baseline@v0.12.0
        with:
          target: 'http://localhost:3000' # EndereÃ§o do servidor local
          fail_action: true # FALHA o job se encontrar vulnerabilidades